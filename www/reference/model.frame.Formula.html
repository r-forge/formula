<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Model Frame/Matrix/Response Construction for Extended Formulas — model.frame.Formula • Formula</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Model Frame/Matrix/Response Construction for Extended Formulas — model.frame.Formula"><meta property="og:description" content="Computation of model frames, model matrices, and model responses for
  extended formulas of class Formula."><meta property="og:image" content="https://Formula.R-Forge.R-project.org/logo.png"><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@AchimZeileis"><meta name="twitter:site" content="@AchimZeileis"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Formula</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2-6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/Formula.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Model Frame/Matrix/Response Construction for Extended Formulas</h1>
    
    <div class="hidden name"><code>model.frame.Formula.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Computation of model frames, model matrices, and model responses for
  extended formulas of class <code>Formula</code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for Formula</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></span><span class="op">(</span><span class="va">formula</span>, data <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span>,</span>
<span>  lhs <span class="op">=</span> <span class="cn">NULL</span>, rhs <span class="op">=</span> <span class="cn">NULL</span>, dot <span class="op">=</span> <span class="st">"separate"</span><span class="op">)</span></span>
<span><span class="co"># S3 method for Formula</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">object</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, <span class="va">...</span>,</span>
<span>  lhs <span class="op">=</span> <span class="cn">NULL</span>, rhs <span class="op">=</span> <span class="fl">1</span>, dot <span class="op">=</span> <span class="st">"separate"</span><span class="op">)</span></span>
<span><span class="co"># S3 method for Formula</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/terms.html" class="external-link">terms</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span>,</span>
<span>  lhs <span class="op">=</span> <span class="cn">NULL</span>, rhs <span class="op">=</span> <span class="cn">NULL</span>, dot <span class="op">=</span> <span class="st">"separate"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">model.part</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for Formula</span></span>
<span><span class="fu">model.part</span><span class="op">(</span><span class="va">object</span>, <span class="va">data</span>, lhs <span class="op">=</span> <span class="fl">0</span>, rhs <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  drop <span class="op">=</span> <span class="cn">FALSE</span>, terms <span class="op">=</span> <span class="cn">FALSE</span>, dot <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>formula, object, x</dt>
<dd><p>an object of class <code>Formula</code>.</p></dd>

  <dt>data</dt>
<dd><p>a data.frame, list or environment containing the variables in
    <code>formula</code>. For <code>model.part</code> it needs to be the <code>model.frame</code>.</p></dd>

  <dt>lhs, rhs</dt>
<dd><p>indexes specifying which elements of the left- and
    right-hand side, respectively, should be employed. <code>NULL</code>
    corresponds to all parts, <code>0</code> to none. At least one <code>lhs</code> or
    one <code>rhs</code> has to be specified.</p></dd>

  <dt>dot</dt>
<dd><p>character specifying how to process formula parts with a dot
    (<code>.</code>) on the right-hand side. This can be: <code>"separate"</code>
    so that each formula part is expanded separately. <code>"sequential"</code>
    so that the parts are expanded sequentially conditional on all prior parts.
    <code>"previous"</code> so the part is expanded to the previous part.</p></dd>

  <dt>drop</dt>
<dd><p>logical. Should the <code>data.frame</code> be dropped for single
    column data frames?</p></dd>

  <dt>terms</dt>
<dd><p>logical. Should the <code>"terms"</code> attribute (corresponding to
    the <code>model.part</code> extracted) be added?</p></dd>

  <dt>...</dt>
<dd><p>further arguments passed to the respective
    <code>formula</code> methods.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>All three model computations leverage the corresponding standard methods.
  Additionally, they allow specification of the part(s) of the left- and right-hand side
  (LHS and RHS) that should be included in the computation.</p>
<p>The idea underlying all three model computations is to extract a suitable
  <code>formula</code> from the more general <code>Formula</code> and then calling
  the standard <code><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></code>, <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></code>,
  and <code><a href="https://rdrr.io/r/stats/terms.html" class="external-link">terms</a></code> methods.</p>  
<p>More specifically, if the <code>Formula</code> has multiple parts on the RHS,
  they are collapsed, essentially replacing <code>|</code> by <code>+</code>. If there
  is only a single response on the LHS, then it is kept on the LHS.
  Otherwise all parts of the formula are collapsed on the RHS (because <code>formula</code>
  objects can not have multiple responses). Hence, for multi-response <code>Formula</code>
  objects, the (non-generic) <code><a href="https://rdrr.io/r/stats/model.extract.html" class="external-link">model.response</a></code> does
  not give the correct results. To avoid confusion a new generic <code>model.part</code> 
  with suitable <code>formula</code> method is provided which can always
  be used instead of <code>model.response</code>. Note, however, that it has a different
  syntax: It requires the <code>Formula</code> object in addition to the readily
  processed <code>model.frame</code> supplied in data
  (and optionally the <code>lhs</code>). Also, it returns either a <code>data.frame</code> with
  multiple columns or a single column (dropping the <code>data.frame</code> property)
  depending on whether multiple responses are employed or not.</p>  
<p>If the the formula contains one or more dots (<code>.</code>), some care has to be
  taken to process these correctly, especially if the LHS contains transformartions
  (such as <code>log</code>, <code>sqrt</code>, <code>cbind</code>, <code>Surv</code>, etc.). Calling the
  <code>terms</code> method with the original data (untransformed, if any) resolves
  all dots (by default separately for each part, otherwise sequentially) and also
  includes the original and updated formula as part of the terms. When calling
  <code>model.part</code> either the original untransformed data should be provided
  along with a <code>dot</code> specification or the transformed <code>model.frame</code>
  from the same formula without another <code>dot</code> specification (in which
  case the <code>dot</code> is inferred from the <code>terms</code> of the <code>model.frame</code>).</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Zeileis A, Croissant Y (2010). Extended Model Formulas in R: Multiple Parts and Multiple Responses.
  <em>Journal of Statistical Software</em>, <b>34</b>(1), 1--13.
  <a href="https://doi.org/10.18637/jss.v034.i01" class="external-link">doi:10.18637/jss.v034.i01</a></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="Formula.html">Formula</a></code>,  <code><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></code>,
  <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></code>, <code><a href="https://rdrr.io/r/stats/terms.html" class="external-link">terms</a></code>,
  <code><a href="https://rdrr.io/r/stats/model.extract.html" class="external-link">model.response</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## artificial example data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1090</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">21</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y1"</span>, <span class="st">"y2"</span>, <span class="st">"y3"</span>, <span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>, <span class="st">"x4"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span> <span class="va">dat</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0.5</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">y2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span><span class="va">dat</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     y1   y2   y3   x1   x2 x3 x4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.82 &lt;NA&gt; 0.27 0.09 0.22  b  a</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.70    b 0.17 0.26 0.46  a  a</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.65    a 0.28 0.03 0.37  b  b</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">######################################</span></span></span>
<span class="r-in"><span><span class="co">## single response and two-part RHS ##</span></span></span>
<span class="r-in"><span><span class="co">######################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## single response with two-part RHS</span></span></span>
<span class="r-in"><span><span class="va">F1</span> <span class="op">&lt;-</span> <span class="fu"><a href="Formula.html">Formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">y1</span><span class="op">)</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">x1</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">F1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## set up model frame</span></span></span>
<span class="r-in"><span><span class="va">mf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></span><span class="op">(</span><span class="va">F1</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mf1</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      log(y1)   x1   x2 I(x1^2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 -0.1984509 0.09 0.22  0.0081</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 -0.3566749 0.26 0.46  0.0676</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 -0.4307829 0.03 0.37   9e-04</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## extract single response</span></span></span>
<span class="r-in"><span><span class="fu">model.part</span><span class="op">(</span><span class="va">F1</span>, data <span class="op">=</span> <span class="va">mf1</span>, lhs <span class="op">=</span> <span class="fl">1</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          1          2          3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -0.1984509 -0.3566749 -0.4307829 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/model.extract.html" class="external-link">model.response</a></span><span class="op">(</span><span class="va">mf1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          1          2          3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -0.1984509 -0.3566749 -0.4307829 </span>
<span class="r-in"><span><span class="co">## model.response() works as usual</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## extract model matrices</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">F1</span>, data <span class="op">=</span> <span class="va">mf1</span>, rhs <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   (Intercept)   x1   x2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           1 0.09 0.22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           1 0.26 0.46</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           1 0.03 0.37</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"assign")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0 1 2</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">F1</span>, data <span class="op">=</span> <span class="va">mf1</span>, rhs <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   (Intercept) I(x1^2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           1  0.0081</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           1  0.0676</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           1  0.0009</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"assign")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0 1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#########################################</span></span></span>
<span class="r-in"><span><span class="co">## multiple responses and multiple RHS ##</span></span></span>
<span class="r-in"><span><span class="co">#########################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## set up Formula</span></span></span>
<span class="r-in"><span><span class="va">F2</span> <span class="op">&lt;-</span> <span class="fu"><a href="Formula.html">Formula</a></span><span class="op">(</span><span class="va">y1</span> <span class="op">+</span> <span class="va">y2</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">y3</span><span class="op">)</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">x2</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">|</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span> <span class="op">|</span> <span class="va">x3</span> <span class="op">/</span> <span class="va">x4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">F2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2 3</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## set up full model frame</span></span></span>
<span class="r-in"><span><span class="va">mf2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></span><span class="op">(</span><span class="va">F2</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mf2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     y1 y2   log(y3)   x1 I(x2^2)   log(x1) x3 x4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.70  b -1.771957 0.26  0.2116 -1.347074  a  a</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.65  a -1.272966 0.03  0.1369 -3.506558  b  b</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## extract responses</span></span></span>
<span class="r-in"><span><span class="fu">model.part</span><span class="op">(</span><span class="va">F2</span>, data <span class="op">=</span> <span class="va">mf2</span>, lhs <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     y1 y2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.70  b</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.65  a</span>
<span class="r-in"><span><span class="fu">model.part</span><span class="op">(</span><span class="va">F2</span>, data <span class="op">=</span> <span class="va">mf2</span>, lhs <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     log(y3)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 -1.771957</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 -1.272966</span>
<span class="r-in"><span><span class="co">## model.response(mf2) does not give correct results!</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## extract model matrices</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">F2</span>, data <span class="op">=</span> <span class="va">mf2</span>, rhs <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   (Intercept)   x1 I(x2^2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           1 0.26  0.2116</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           1 0.03  0.1369</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"assign")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0 1 2</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">F2</span>, data <span class="op">=</span> <span class="va">mf2</span>, rhs <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     log(x1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 -1.347074</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 -3.506558</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"assign")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">F2</span>, data <span class="op">=</span> <span class="va">mf2</span>, rhs <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   (Intercept) x3b x3a:x4b x3b:x4b</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           1   0       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           1   1       0       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"assign")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0 1 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"contrasts")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"contrasts")$x3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "contr.treatment"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"contrasts")$x4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "contr.treatment"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#######################</span></span></span>
<span class="r-in"><span><span class="co">## Formulas with '.' ##</span></span></span>
<span class="r-in"><span><span class="co">#######################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## set up Formula with a single '.'</span></span></span>
<span class="r-in"><span><span class="va">F3</span> <span class="op">&lt;-</span> <span class="fu"><a href="Formula.html">Formula</a></span><span class="op">(</span><span class="va">y1</span> <span class="op">|</span> <span class="va">y2</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mf3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></span><span class="op">(</span><span class="va">F3</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## without y1 or y2</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">F3</span>, data <span class="op">=</span> <span class="va">mf3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   (Intercept)   y3   x1   x2 x3b x4b</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           1 0.17 0.26 0.46   0   0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           1 0.28 0.03 0.37   1   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"assign")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0 1 2 3 4 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"contrasts")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"contrasts")$x3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "contr.treatment"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"contrasts")$x4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "contr.treatment"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">## without y1 but with y2</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">F3</span>, data <span class="op">=</span> <span class="va">mf3</span>, lhs <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   (Intercept) y2b   y3   x1   x2 x3b x4b</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           1   1 0.17 0.26 0.46   0   0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           1   0 0.28 0.03 0.37   1   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"assign")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0 1 2 3 4 5 6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"contrasts")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"contrasts")$y2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "contr.treatment"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"contrasts")$x3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "contr.treatment"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"contrasts")$x4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "contr.treatment"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">## without y2 but with y1</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">F3</span>, data <span class="op">=</span> <span class="va">mf3</span>, lhs <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   (Intercept)   y1   y3   x1   x2 x3b x4b</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           1 0.70 0.17 0.26 0.46   0   0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           1 0.65 0.28 0.03 0.37   1   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"assign")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0 1 2 3 4 5 6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"contrasts")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"contrasts")$x3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "contr.treatment"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"contrasts")$x4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "contr.treatment"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## set up Formula with multiple '.'</span></span></span>
<span class="r-in"><span><span class="va">F3</span> <span class="op">&lt;-</span> <span class="fu"><a href="Formula.html">Formula</a></span><span class="op">(</span><span class="va">y1</span> <span class="op">|</span> <span class="va">y2</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">y3</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">x3</span> <span class="op">-</span> <span class="va">x4</span> <span class="op">|</span> <span class="va">.</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## process both '.' separately (default)</span></span></span>
<span class="r-in"><span><span class="va">mf3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></span><span class="op">(</span><span class="va">F3</span>, data <span class="op">=</span> <span class="va">dat</span>, dot <span class="op">=</span> <span class="st">"separate"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## only x1-x2</span></span></span>
<span class="r-in"><span><span class="fu">model.part</span><span class="op">(</span><span class="va">F3</span>, data <span class="op">=</span> <span class="va">mf3</span>, rhs <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     x1   x2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.26 0.46</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.03 0.37</span>
<span class="r-in"><span><span class="co">## all x1-x4</span></span></span>
<span class="r-in"><span><span class="fu">model.part</span><span class="op">(</span><span class="va">F3</span>, data <span class="op">=</span> <span class="va">mf3</span>, rhs <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     x1   x2 x3 x4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.26 0.46  a  a</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.03 0.37  b  b</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## process the '.' sequentially, i.e., the second RHS conditional on the first</span></span></span>
<span class="r-in"><span><span class="va">mf3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></span><span class="op">(</span><span class="va">F3</span>, data <span class="op">=</span> <span class="va">dat</span>, dot <span class="op">=</span> <span class="st">"sequential"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## only x1-x2</span></span></span>
<span class="r-in"><span><span class="fu">model.part</span><span class="op">(</span><span class="va">F3</span>, data <span class="op">=</span> <span class="va">mf3</span>, rhs <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     x1   x2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.26 0.46</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.03 0.37</span>
<span class="r-in"><span><span class="co">## only x3-x4</span></span></span>
<span class="r-in"><span><span class="fu">model.part</span><span class="op">(</span><span class="va">F3</span>, data <span class="op">=</span> <span class="va">mf3</span>, rhs <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   x3 x4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  a  a</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  b  b</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## process the second '.' using the previous RHS element</span></span></span>
<span class="r-in"><span><span class="va">mf3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></span><span class="op">(</span><span class="va">F3</span>, data <span class="op">=</span> <span class="va">dat</span>, dot <span class="op">=</span> <span class="st">"previous"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## only x1-x2</span></span></span>
<span class="r-in"><span><span class="fu">model.part</span><span class="op">(</span><span class="va">F3</span>, data <span class="op">=</span> <span class="va">mf3</span>, rhs <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     x1   x2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.26 0.46</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.03 0.37</span>
<span class="r-in"><span><span class="co">## x1-x2 again</span></span></span>
<span class="r-in"><span><span class="fu">model.part</span><span class="op">(</span><span class="va">F3</span>, data <span class="op">=</span> <span class="va">mf3</span>, rhs <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     x1   x2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.26 0.46</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.03 0.37</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##############################</span></span></span>
<span class="r-in"><span><span class="co">## Process multiple offsets ##</span></span></span>
<span class="r-in"><span><span class="co">##############################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## set up Formula</span></span></span>
<span class="r-in"><span><span class="va">F4</span> <span class="op">&lt;-</span> <span class="fu"><a href="Formula.html">Formula</a></span><span class="op">(</span><span class="va">y1</span> <span class="op">~</span> <span class="va">x3</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span> <span class="op">|</span> <span class="va">x4</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mf4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></span><span class="op">(</span><span class="va">F4</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## model.part can be applied as above and includes offset!</span></span></span>
<span class="r-in"><span><span class="fu">model.part</span><span class="op">(</span><span class="va">F4</span>, data <span class="op">=</span> <span class="va">mf4</span>, rhs <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   x3 offset(x1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  b       0.09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  a       0.26</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  b       0.03</span>
<span class="r-in"><span><span class="co">## additionally, the corresponding corresponding terms can be included</span></span></span>
<span class="r-in"><span><span class="fu">model.part</span><span class="op">(</span><span class="va">F4</span>, data <span class="op">=</span> <span class="va">mf4</span>, rhs <span class="op">=</span> <span class="fl">1</span>, terms <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   x3 offset(x1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  b       0.09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  a       0.26</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  b       0.03</span>
<span class="r-in"><span><span class="co">## hence model.offset() can be applied to extract offsets</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/model.extract.html" class="external-link">model.offset</a></span><span class="op">(</span><span class="fu">model.part</span><span class="op">(</span><span class="va">F4</span>, data <span class="op">=</span> <span class="va">mf4</span>, rhs <span class="op">=</span> <span class="fl">1</span>, terms <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.09 0.26 0.03</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/model.extract.html" class="external-link">model.offset</a></span><span class="op">(</span><span class="fu">model.part</span><span class="op">(</span><span class="va">F4</span>, data <span class="op">=</span> <span class="va">mf4</span>, rhs <span class="op">=</span> <span class="fl">2</span>, terms <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -1.5141277 -0.7765288 -0.9942523</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Achim Zeileis, Yves Croissant.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

